# PanHouse Slide Editor - アーキテクチャ設計

最終更新: 2025-12-02

## 設計思想

### 2つのシステムの良いところを統合

| 機能 | GASスライドジェネレーター | wills_ph3エディタ | 新エディタ |
|------|--------------------------|-------------------|------------|
| 入力方式 | JSON定義 | 手動配置 | **両方対応** |
| スライドタイプ | 19種類定義済み | 自由配置 | **タイプ+自由配置** |
| 編集 | Google Slidesで編集 | ブラウザで編集 | **ブラウザで編集** |
| 画像 | URL必須 | ローカルアップロード | **ローカル対応** |
| 出力 | Google Slides | PDF/HTML | **PDF/PPTX/HTML/JSON** |
| テーマ | 11種類 | なし | **テーマ対応** |

---

## 処理フロー

```
┌─────────────────────────────────────────────────────────────────┐
│                         入力                                     │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │
│  │ JSON直接入力 │  │ ファイル読込 │  │ テンプレート │             │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘             │
│         └────────────────┼────────────────┘                     │
│                          ↓                                       │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │                    JsonParser                                ││
│  │  - JSON検証                                                  ││
│  │  - スライドタイプ判定                                        ││
│  │  - データ正規化                                              ││
│  └─────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────────┐
│                       SlideManager                               │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │  slides: [                                                   ││
│  │    { id, type, data, elements, notes },                      ││
│  │    ...                                                       ││
│  │  ]                                                           ││
│  │  settings: { theme, companyName, ... }                       ││
│  │  currentIndex: 0                                             ││
│  └─────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────────┐
│                      SlideRenderer                               │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐                │
│  │TitleRenderer│  │ContentRenderer│ │TableRenderer│  ...         │
│  └────────────┘  └────────────┘  └────────────┘                │
│         ↓               ↓               ↓                        │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │                    HTML/CSS生成                              ││
│  └─────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────────┐
│                        Editor UI                                 │
│  ┌───────────┬─────────────────────────────┬───────────────────┐│
│  │ PageList  │         Canvas              │    Properties     ││
│  │           │                             │                   ││
│  │ サムネイル │    ドラッグ&ドロップ        │   タイプ別        ││
│  │ 一覧      │    リサイズ                 │   プロパティ      ││
│  │           │    テキスト編集             │   編集            ││
│  └───────────┴─────────────────────────────┴───────────────────┘│
└─────────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────────┐
│                        出力                                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌────────┐│
│  │ PdfExporter │  │ PptxExporter│  │ HtmlExporter│  │JSON出力││
│  │ (jsPDF)     │  │ (pptxgenjs) │  │ (静的HTML)  │  │(再編集)││
│  └─────────────┘  └─────────────┘  └─────────────┘  └────────┘│
└─────────────────────────────────────────────────────────────────┘
```

---

## UI構成

```
┌─────────────────────────────────────────────────────────────────┐
│ ヘッダー                                                         │
│ ┌──────┐ ┌──────────────────────────┐ ┌─────────┐ ┌──────────┐│
│ │ロゴ  │ │ツール: 選択/テキスト/画像│ │テーマ ▼ │ │エクスポート││
│ └──────┘ └──────────────────────────┘ └─────────┘ └──────────┘│
├───────────┬─────────────────────────────┬───────────────────────┤
│ ページ一覧│           キャンバス         │      プロパティ       │
│ (150px)   │          (中央)             │       (280px)         │
│           │                             │                       │
│ ┌───────┐│  ┌─────────────────────┐   │ スライドタイプ        │
│ │ p.1   ││  │                     │   │ ┌─────────────────┐  │
│ │[thumb]││  │   スライド表示      │   │ │ title ▼        │  │
│ └───────┘│  │   (16:9 or A4)      │   │ └─────────────────┘  │
│ ┌───────┐│  │                     │   │                       │
│ │ p.2   ││  │   ドラッグ&ドロップ  │   │ タイトル              │
│ │[thumb]││  │   で要素移動        │   │ ┌─────────────────┐  │
│ └───────┘│  │                     │   │ │ スライドタイトル │  │
│ ┌───────┐│  │                     │   │ └─────────────────┘  │
│ │ + 追加││  └─────────────────────┘   │                       │
│ └───────┘│                             │ コンテンツ            │
│           │                             │ ┌─────────────────┐  │
│           │                             │ │ 項目1           │  │
│           │                             │ │ 項目2           │  │
│           │                             │ └─────────────────┘  │
│           │                             │                       │
│           │                             │ スピーカーノート      │
│           │                             │ ┌─────────────────┐  │
│           │                             │ │                 │  │
│           │                             │ └─────────────────┘  │
├───────────┴─────────────────────────────┴───────────────────────┤
│ フッター: ズーム [50%] [100%] [150%]  |  ページ 1 / 10          │
└─────────────────────────────────────────────────────────────────┘
```

---

## スライドタイプ（GASから継承）

### 基本タイプ
| タイプ | 用途 | 必須フィールド |
|--------|------|----------------|
| `title` | タイトルスライド | title |
| `section` | セクション区切り | title |
| `content` | 箇条書き | title, points[] |
| `agenda` | アジェンダ | title, items[] |
| `closing` | クロージング | title |

### コンテンツタイプ
| タイプ | 用途 | 必須フィールド |
|--------|------|----------------|
| `table` | テーブル | title, headers[], rows[][] |
| `compare` | 左右比較 | title, leftTitle, rightTitle, leftItems[], rightItems[] |
| `cards` | カードグリッド | title, items[{title, desc}] |
| `timeline` | タイムライン | title, milestones[{date, label}] |
| `process` | プロセスステップ | title, steps[] |

### 拡張タイプ
| タイプ | 用途 | 必須フィールド |
|--------|------|----------------|
| `quote` | 引用 | title, text, author |
| `faq` | FAQ | title, items[{q, a}] |
| `progress` | 進捗バー | title, items[{label, percent}] |
| `cycle` | サイクル図 | title, items[{title, desc}] |
| `diagram` | スイムレーン | title, lanes[{title, items[]}] |
| `imageText` | 画像+テキスト | title, imageUrl, points[] |

---

## データ構造

### スライドJSON形式
```json
{
  "settings": {
    "title": "プレゼンテーション名",
    "theme": "panhouse",
    "aspectRatio": "16:9",
    "companyName": "株式会社パンハウス",
    "footerText": "© 2025 PanHouse Inc."
  },
  "slides": [
    {
      "type": "title",
      "title": "提案書タイトル",
      "subtitle": "サブタイトル",
      "date": "2025年12月2日",
      "notes": "スピーカーノート"
    },
    {
      "type": "content",
      "title": "アジェンダ",
      "points": ["項目1", "項目2", "項目3"],
      "notes": "説明用メモ"
    }
  ]
}
```

### 内部データ構造（SlideManager）
```javascript
{
  settings: {
    title: "プレゼンテーション名",
    theme: "panhouse",
    aspectRatio: "16:9"
  },
  slides: [
    {
      id: "slide-001",
      type: "title",
      data: {
        title: "提案書タイトル",
        subtitle: "サブタイトル"
      },
      elements: [
        // 自由配置要素（オプション）
        { id: "el-001", type: "text", x: 100, y: 200, ... }
      ],
      notes: "スピーカーノート"
    }
  ],
  currentIndex: 0
}
```

---

## テーマシステム

### CSS変数ベース
```css
:root {
  /* PanHouseテーマ */
  --primary-color: #FF6600;
  --secondary-color: #1E3A5F;
  --text-color: #333333;
  --background-color: #FFFFFF;
  --accent-color: #FF6600;
}

[data-theme="blue"] {
  --primary-color: #2563EB;
  --secondary-color: #1E3A8A;
}
```

### テーマ一覧
| テーマID | 名前 | メインカラー |
|----------|------|-------------|
| `panhouse` | PanHouse標準 | オレンジ×濃紺 |
| `blue` | コーポレートブルー | 青 |
| `dark_blue` | ダークブルー | 濃青 |
| `green` | グリーン | 緑 |
| `minimal` | ミニマル | グレー |

---

## ファイル構成

```
slide/
├── index.html                  # メインエントリーポイント
│
├── css/
│   ├── editor.css              # エディタUIスタイル
│   ├── slide.css               # スライドコンテンツスタイル
│   ├── components.css          # 共通コンポーネント
│   └── themes/
│       ├── panhouse.css
│       ├── blue.css
│       ├── green.css
│       └── minimal.css
│
├── js/
│   ├── app.js                  # メインアプリケーション起動
│   │
│   ├── core/
│   │   ├── SlideManager.js     # スライドデータ管理
│   │   ├── JsonParser.js       # JSON解析・検証
│   │   ├── EventBus.js         # イベント管理（pub/sub）
│   │   └── Utils.js            # ユーティリティ関数
│   │
│   ├── editor/
│   │   ├── Editor.js           # エディタコア（統合管理）
│   │   ├── Canvas.js           # キャンバス描画・操作
│   │   ├── PageList.js         # ページ一覧サイドバー
│   │   ├── Properties.js       # プロパティパネル
│   │   ├── Toolbar.js          # ツールバー
│   │   └── DragDrop.js         # ドラッグ&ドロップ処理
│   │
│   ├── renderer/
│   │   ├── SlideRenderer.js    # メインレンダラー（タイプ振り分け）
│   │   └── types/
│   │       ├── BaseRenderer.js     # 基底クラス
│   │       ├── TitleRenderer.js
│   │       ├── ContentRenderer.js
│   │       ├── TableRenderer.js
│   │       ├── CompareRenderer.js
│   │       ├── CardsRenderer.js
│   │       ├── TimelineRenderer.js
│   │       ├── ProcessRenderer.js
│   │       └── ImageTextRenderer.js
│   │
│   ├── themes/
│   │   └── ThemeManager.js     # テーマ切り替え管理
│   │
│   └── export/
│       ├── Exporter.js         # エクスポート基底クラス
│       ├── PdfExporter.js      # PDF出力（jsPDF）
│       ├── PptxExporter.js     # PPTX出力（pptxgenjs）
│       ├── HtmlExporter.js     # HTML出力
│       └── JsonExporter.js     # JSON出力（再編集用）
│
├── samples/
│   ├── proposal.json           # 提案書サンプル
│   ├── progress.json           # 進捗報告サンプル
│   ├── training.json           # 研修資料サンプル
│   └── nikken_mtg.json         # nikken案件サンプル
│
├── templates/
│   ├── proposal.json           # 提案書テンプレート（空）
│   ├── progress.json           # 進捗報告テンプレート
│   └── training.json           # 研修テンプレート
│
└── docs/
    ├── ARCHITECTURE.md         # このファイル
    ├── SLIDE_TYPES.md          # スライドタイプ詳細仕様
    └── THEMES.md               # テーマカスタマイズガイド
```

---

## 実装優先順位

### Phase 1: MVP（最小実装）
1. [ ] 基本HTML/CSS構造
2. [ ] SlideManager（データ管理）
3. [ ] JsonParser（JSON読み込み）
4. [ ] 基本レンダラー（title, content, table）
5. [ ] ページ一覧表示
6. [ ] PDF出力

### Phase 2: 編集機能
7. [ ] プロパティパネル
8. [ ] テキスト編集
9. [ ] ドラッグ&ドロップ
10. [ ] テーマ切り替え

### Phase 3: 拡張
11. [ ] 全スライドタイプ実装
12. [ ] 画像アップロード
13. [ ] PPTX出力
14. [ ] テンプレート機能

---

## 技術スタック

| 用途 | ライブラリ | 理由 |
|------|-----------|------|
| 基盤 | Vanilla JS | 依存なし、シンプル |
| グラフ | Chart.js | 軽量、十分な機能 |
| PDF出力 | html2canvas + jsPDF | 実績あり |
| PPTX出力 | pptxgenjs | PowerPoint互換 |
| アイコン | SVGインライン | 依存なし |

---

## 参考

- GASスライドジェネレーター: `scripts/slide_generator/`
- wills_ph3エディタ: `project/dev/01_顧客/03_wills_ph3/editor/`
- まじん式コード: `scripts/slide_generator/majin_code_reference.gs`
